@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

actor "CLB" as CLB
participant ":RecordEntryUI" as UI
participant ":RecordEntryController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "entryRepository\n:EntryRepository" as EntryRepo
participant "teamRepository\n:TeamRepository" as TeamRepo
participant "vehicleRepository\n:VehicleRepository" as vehicleRepo
participant "AgendaEntryMapper" as EntryMapper
participant "agendaEntry\n:AgendaEntry" as AgendaEntry
participant "agendaEntryDto\n:AgendaEntryDto" as agendaEntryDto
participant "team\n:Team" as team
participant "vehicle\n:Vehicle" as vehicle


activate CLB

    CLB -> UI : asks to record a complete agendaEntry
    activate UI

        UI -> CTRL** : create
        deactivate UI
        activate CTRL

            CTRL -> RepositorySingleton: getInstance()
            activate RepositorySingleton

                RepositorySingleton --> CTRL: repositories
            deactivate RepositorySingleton

            CTRL -> PLAT : getTeamRepository()
            activate PLAT

                PLAT --> CTRL: teamRepository
            deactivate PLAT

            CTRL -> PLAT : getEntryRepository()
            activate PLAT

                PLAT --> CTRL: entryRepository
            deactivate PLAT


        deactivate CTRL

        UI -> CTRL: getAgendaEntryOfCollaboratorList(CLB)
        activate UI
        activate CTRL

            CTRL -> EntryRepo: getAgendaEntriesAssignedToCollaborator(CLB)
            activate EntryRepo


            EntryRepo --> CTRL: agendaEntryList
            deactivate EntryRepo

            CTRL -> EntryMapper: toDtoList(agendaEntryList)
            deactivate CTRL
            activate EntryMapper

            loop

                EntryMapper -> agendaEntryDto**: create
                activate agendaEntryDto

                agendaEntryDto --> EntryMapper: agendaEntryDto
                deactivate agendaEntryDto

            end loop

            EntryMapper --> CTRL: agendaEntryDtoList
            deactivate EntryMapper
            activate CTRL



        CTRL --> UI : agendaEntryDtoList
        deactivate CTRL

        UI -> CLB : shows the list of the agendaEntry assign to the collaborator and requests to select the one to record
    deactivate UI

    CLB -> UI : select an assigned agendaEntry
    activate UI

        UI --> CLB : show agendaEntry and requests confirmation
    deactivate UI

    CLB -> UI : confirms data
    activate UI

        UI -> CTRL : recordEntryCompletion(selectedAgendaEntryDto, flag)
        deactivate UI
        activate CTRL

            CTRL -> EntryMapper : toDomain(selectedAgendaEntryDto)
            deactivate CTRL
            activate EntryMapper

                EntryMapper -> AgendaEntry** : create
                activate AgendaEntry

                AgendaEntry --> EntryMapper : agendaEntry
                deactivate AgendaEntry

                EntryMapper --> CTRL : agendaEntry
            deactivate EntryMapper
            activate CTRL

            CTRL -> vehicleRepo: setVehicleAvailable(assignedVehicles, flag)
            deactivate CTRL
            activate vehicleRepo

                loop
                vehicleRepo -> vehicle: setAvailable(flag)
                activate vehicle

                vehicle--> vehicleRepo
                deactivate vehicle
                end loop

            vehicleRepo --> CTRL: success
            deactivate vehicleRepo
            activate CTRL

            CTRL -> TeamRepo: setTeamAvailable(team, flag)
            deactivate CTRL
            activate TeamRepo

                TeamRepo -> team: setAvailable(flag)
                activate team

                team --> TeamRepo
                deactivate team

            TeamRepo --> CTRL: success
            deactivate TeamRepo
            activate CTRL

            CTRL -> EntryRepo : recordAgendaEntryCompletion(agendaEntry, COMPLETED)
            deactivate CTRL
            activate EntryRepo

                EntryRepo -> AgendaEntry : setStatus(COMPLETED)
                activate AgendaEntry

                AgendaEntry -> EntryRepo : success
                deactivate AgendaEntry


                deactivate AgendaEntry


            EntryRepo --> CTRL : success
            deactivate EntryRepo
            activate CTRL

            CTRL --> UI : success
        deactivate CTRL
        activate UI

        UI --> CLB : displays a success message (agendaEntry recorded as completed)
    deactivate UI

@enduml
