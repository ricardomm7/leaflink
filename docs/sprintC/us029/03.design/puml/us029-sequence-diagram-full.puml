@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

actor "CLB" as CLB
participant ":RecordEntryUI" as UI
participant ":RecordEntryController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "entryRepository:\nEntryRepository" as EntryRepo
participant "teamRepository:\nTeamRepository" as TeamRepo
participant "agendaRepository:\nAgendaRepository" as AgendaRepo
participant "toDoListRepository:\nToDoListRepository" as ToDoRepo
participant "entry\n:Entry" as Entry
participant "EntryMapper" as EntryMapper

activate CLB

    CLB -> UI : asks to record a complete entry
    activate UI

        UI -> CTRL : create
        deactivate UI
        activate CTRL

            CTRL -> RepositorySingleton: getInstance()
            activate RepositorySingleton

                RepositorySingleton --> CTRL: repositories
            deactivate RepositorySingleton

            CTRL -> PLAT : getTeamRepository()
            activate PLAT

                PLAT --> CTRL: teamRepository
            deactivate PLAT

            CTRL -> PLAT : getEntryRepository()
            activate PLAT

                PLAT --> CTRL: entryRepository
            deactivate PLAT

            CTRL -> PLAT : getAgendaRepository()
            activate PLAT

                PLAT --> CTRL: agendaRepository
            deactivate PLAT

            CTRL -> PLAT : getToDoListRepository()
            activate PLAT

                PLAT --> CTRL: toDoListRepository
            deactivate PLAT

        deactivate CTRL

        UI -> CTRL: getEntryOfCollaboratorList()
        activate UI
        activate CTRL

            CTRL -> TeamRepo: getEntriesAssignedToCollaborator(CLB)
            activate TeamRepo

                TeamRepo --> CTRL: entryList
            deactivate TeamRepo

            loop for each entry in entryList
                CTRL -> EntryRepo: verifyEntryInAgenda(entry)
                activate EntryRepo

                    EntryRepo -> AgendaRepo: isInAgenda(entry)
                    activate AgendaRepo

                        AgendaRepo --> EntryRepo: inAgenda
                    deactivate AgendaRepo

                deactivate EntryRepo

                CTRL -> EntryRepo: verifyEntryInToDoList(entry)
                activate EntryRepo

                    EntryRepo -> ToDoRepo: isInToDoList(entry)
                    activate ToDoRepo

                        ToDoRepo --> EntryRepo: inToDoList
                    deactivate ToDoRepo

                deactivate EntryRepo
            end

            CTRL -> EntryMapper : toDTO(entryList)
            activate EntryMapper

                EntryMapper --> CTRL : entryDTOList
            deactivate EntryMapper

            CTRL --> UI : entryDTOList
        deactivate CTRL

        UI -> CLB : shows the list of the entry assign to the collaborator and requests to select the one to record
    deactivate UI

    CLB -> UI : select an assigned entry
    activate UI

        UI --> CLB : show entry and requests confirmation
    deactivate UI

    CLB -> UI : confirms data
    activate UI

        UI -> CTRL : recordEntryCompletion(selectedEntryDTO)
        deactivate UI
        activate CTRL

            CTRL -> EntryMapper : toEntry(selectedEntryDTO)
            activate EntryMapper

                EntryMapper --> CTRL : selectedEntry
            deactivate EntryMapper

            CTRL -> EntryRepo : recordEntryCompletion(selectedEntry, COMPLETED)
            deactivate CTRL
            activate EntryRepo

                EntryRepo -> Entry : setStatus(COMPLETED)
                deactivate EntryRepo
                activate Entry

                Entry -> EntryRepo : success
                deactivate Entry
                activate EntryRepo

            EntryRepo --> CTRL : success
            deactivate EntryRepo
            activate CTRL

            CTRL --> UI : success
        deactivate CTRL
        activate UI

        UI --> CLB : displays a success message (Entry recorded as completed)
    deactivate UI

@enduml
