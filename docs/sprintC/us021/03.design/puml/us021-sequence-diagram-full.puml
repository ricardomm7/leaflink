
@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false


autonumber

actor "GSM" as GSM
participant ":ListTaskSpaceUI" as UI
participant ":ListTaskController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "greenSpaceRepository:\nGreenSpaceRepository" as GreenSpaceRepository
participant "entryRepository\n:EntryRepository" as EntryRep
participant ":ToDoEntryMapper" as ToDoEntryMapper
participant "AgendaEntry" as Entry
participant "greenSpaceMapper\n:GreenSpaceMapper" as GreenSpaceMapper
participant "greenSpaceDto\n:GreenSpaceDto" as GreenSpaceDTO
participant "toDoEntryDto\n:ToDoEntryDto" as ToDoEntryDto

activate GSM

    GSM -> UI : asks to add a new entry
    activate UI


        UI -> CTRL** : create
        activate CTRL

        CTRL -> RepositorySingleton : getInstance()
        activate RepositorySingleton


        RepositorySingleton --> CTRL : repositories
        deactivate RepositorySingleton

        CTRL -> PLAT :getGreenSpaceRepository
        activate PLAT


        PLAT --> CTRL : GreenSpaceRepository
        deactivate PLAT

         CTRL -> PLAT : getEntryRepository()
        activate PLAT

        PLAT --> CTRL : entryRepository
        deactivate PLAT
        deactivate CTRL

        UI -> CTRL : getGreenSpacesDto
        activate CTRL




        CTRL -> GreenSpaceRepository : getGreenSpaceList()
        deactivate CTRL
        activate GreenSpaceRepository

        GreenSpaceRepository --> CTRL : greenSpaceList
        deactivate GreenSpaceRepository
        activate CTRL

        CTRL -> GreenSpaceMapper: toDtoList(greenSpaceList)
        deactivate CTRL
        activate GreenSpaceMapper


        loop

        GreenSpaceMapper -> GreenSpaceDTO** : create
        activate GreenSpaceDTO
        deactivate GreenSpaceMapper

        GreenSpaceDTO --> GreenSpaceMapper: greenSpaceDto
        deactivate GreenSpaceDTO
        activate GreenSpaceMapper
        end loop

        GreenSpaceMapper --> CTRL: greenSpaceListDto
        deactivate GreenSpaceMapper
        activate CTRL

        CTRL --> UI : greenSpaceListDto
        deactivate CTRL


        UI --> GSM : displays list of green spaces
        deactivate UI

        GSM -> UI : Selects the green space
        activate UI

        UI --> GSM : requests entry data (description, degree of urgency, and approximate expected duration)
        deactivate UI

        GSM -> UI : types requested data
        activate UI

        UI -> CTRL : createNewToDoEntry(greenSpaceDto, description, degreeOfUrgency, duration)
        deactivate UI
        activate CTRL

CTRL -> ToDoEntryDto** : create(greenSpaceDto, description, degreeOfUrgency, duration)
activate ToDoEntryDto
ToDoEntryDto --> CTRL : entryDto
deactivate ToDoEntryDto

        CTRL -> EntryRep : createNewToDoEntry(entryDto)
        deactivate CTRL
        activate EntryRep



EntryRep -> ToDoEntryMapper : toDomain(entryDto)
activate ToDoEntryMapper

ToDoEntryMapper -> Entry** : create

activate Entry
Entry -> Entry : verifyFilled(description)
        activate Entry

        Entry -> Entry : verifyDuration(aproxExpDuration)
        activate Entry

        Entry --> Entry
        deactivate Entry

        Entry --> Entry
        deactivate Entry

Entry --> ToDoEntryMapper : entry
deactivate Entry

       ToDoEntryMapper -->EntryRep : entry
       deactivate ToDoEntryMapper

       EntryRep -> EntryRep : checkForDuplicates(entry)
       activate EntryRep
       EntryRep->EntryRep : add(entry)
       activate EntryRep
       EntryRep--> EntryRep
       deactivate EntryRep
         EntryRep--> EntryRep
              deactivate EntryRep



        EntryRep --> CTRL : success
        deactivate EntryRep
        activate CTRL

        CTRL --> UI : success
        deactivate CTRL
        activate UI

    UI --> GSM : displays success message (Entry registered successfully)
    deactivate UI

deactivate GSM

@enduml
